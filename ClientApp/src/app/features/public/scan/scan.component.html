<div class="mobile-app-container">
    <div class="app-header">
        <button mat-icon-button class="back-btn" (click)="goBack()">
            <mat-icon>close</mat-icon>
        </button>
        <span class="header-title">Quét mã QR</span>
        <div class="header-actions"></div>
    </div>

    <div class="scan-container">
        <div class="camera-wrapper">
            <!-- Loading indicator -->
            <div *ngIf="isLoading" class="loading-overlay">
                <mat-spinner diameter="40"></mat-spinner>
                <p>Đang khởi tạo camera...</p>
            </div>

            <!-- Permission Error -->
            <div *ngIf="!hasPermission" class="error-overlay">
                <mat-icon color="warn">videocam_off</mat-icon>
                <p>Truy cập camera bị từ chối hoặc không có sẵn.</p>
                <p class="small-text">Vui lòng bật quyền truy cập và đảm bảo bạn đang sử dụng HTTPS.</p>
            </div>

            <ngx-scanner-qrcode #action="scanner" [config]="config" [isBeep]="false"
                (event)="onEvent($event)"></ngx-scanner-qrcode>
        </div>

        <div class="instruction-text">
            <p>Điều chỉnh QR code trong khung để quét.</p>
        </div>

        <div class="controls">
            <!-- Only show play button if not auto-started or stopped manually -->
            <button mat-fab color="primary" (click)="handle(action, 'togglePlay')" class="control-btn"
                *ngIf="!isLoading">
                <mat-icon>{{ action.isStart ? 'stop' : 'play_arrow' }}</mat-icon>
            </button>
            <button mat-fab (click)="handle(action, 'toggleTorcher')" class="control-btn" *ngIf="action.isStart">
                <mat-icon>flash_on</mat-icon>
            </button>
        </div>
    </div>
</div>